<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout}"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}">
</head>

<style>
  .post-title {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
  }

  .post-meta {
    font-size: 0.875rem; /* 작게 표시 */
    color: gray; /* 글자 색상 회색 */
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .post-meta span.separator {
    margin: 0 5.0rem; /* 양쪽에 0.5rem 여백 추가 */
  }
</style>
<body>
<div layout:fragment="content" class="container my-3">
  <!-- 질문 -->
  <h2 class="post-title" th:text="${post.title}"></h2>
  <div class="post-meta">
    <span th:if="${post.author != null}" th:text="${post.author.nickname}"></span>
    <span class="separator">|</span>
    <span th:text="${#temporals.format(post.createAt, 'yyyy.MM.dd HH:mm')}"></span>
  </div>
  <div class="card my-3">
    <div class="card-body">
      <div class="card-text" style="white-space:pre-line;" th:utext="${@commonUtil.markdown(post.content)}"></div>
      <div class="order-price" th:if="${post.order_price != null}">
        <strong>포상금 : </strong> <span th:text="${post.order_price} + '원'"></span>
      </div>


      <div class="mb-3" th:if="${post.imageList != null and !post.imageList.isEmpty()}">
        <label class="form-label"></label>
        <div>
          <th:block th:each="file : ${post.imageList}">
            <div th:if="${#strings.endsWith(file.url, '.mp4') or #strings.endsWith(file.url, '.webm') or #strings.endsWith(file.url, '.ogg')}">
              <!-- 동영상일 경우 -->
              <video width="320" height="240" controls>
                <source th:src="${file.url}" type="video/mp4">
              </video>
            </div>
            <div th:if="${#strings.endsWith(file.url, '.jpg') or #strings.endsWith(file.url, '.jpeg') or #strings.endsWith(file.url, '.png') or #strings.endsWith(file.url, '.gif')}">
              <!-- 이미지일 경우 -->
              <img th:src="${file.url}" alt="Image" width="200px" height="200px">
            </div>
          </th:block>
        </div>
      </div> <!-- 여기서 누락된 </div> 추가 -->

      <div class="my-3">
        <a th:href="@{|/post/modify/${post.id}|}" class="btn btn-sm btn-outline-secondary"
           sec:authorize="isAuthenticated()"
           th:if="${post.author != null and #authentication.getPrincipal().getUsername() == post.author.username}"
           th:text="수정"></a>
        <a href="javascript:void(0);" th:data-uri="@{|/post/delete/${post.id}|}"
           class="delete btn btn-sm btn-outline-secondary" sec:authorize="isAuthenticated()"
           th:if="${post.author != null and #authentication.getPrincipal().getUsername() == post.author.username}"
           th:text="삭제"></a>
      </div>

    </div>
  </div>
  <!-- 답변의 갯수 표시  -->
  <h5 class="border-bottom my-3 py-2" th:text="|${#lists.size(post.contentList)}개의 답변이 있습니다.|"></h5>
  <!-- 답변 반복 시작 -->
  <div class="card my-3" th:each="content : ${post.contentList}">
    <div class="card-body">
      <div class="card-text" style="white-space: pre-line;" th:utext="${@commonUtil.markdown(content.content)}"></div>
      <div class="d-flex justify-content-end">
        <div class="badge bg-light text-dark p-2 text-start">
          <div class="mb-2">
            <span th:if="${content.author != null}" th:text="${content.author.nickname}"></span>
          </div>
          <div th:text="${#temporals.format(content.createAt, 'yyyy-MM-dd HH:mm')}"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- 답변 작성 -->
  <form th:action="@{|/content/create/${post.id}|}" th:object="${contentForm}" method="post" class="my-3">
    <div th:replace="~{form_errors :: formErrorsFragment}"></div>
    <textarea sec:authorize="isAnonymous()" disabled th:field="*{content}" class="form-control" rows="10"></textarea>
    <textarea sec:authorize="isAuthenticated()" th:field="*{content}" class="form-control" rows="10"></textarea>
    <input type="submit" value="답변 등록" class="btn btn-primary my-2">
  </form>
</div>
<script layout:fragment="script" type='text/javascript'>
  const delete_elements = document.getElementsByClassName("delete");
  Array.from(delete_elements).forEach(function(element) {
    element.addEventListener('click', function() {
      if(confirm("정말로 삭제하시겠습니까?")) {
        location.href = this.dataset.uri;
      }
    });
  });
</script>
</body>
</html>